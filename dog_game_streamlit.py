# dog_game_streamlit_tuned.py
import streamlit as st
import random

st.set_page_config(page_title="çŠ¬ã®ä¾¡å€¤è¦³ã‚²ãƒ¼ãƒ ï¼ˆèª¿æ•´ç‰ˆï¼‰", layout="centered")
st.title("ğŸ¶ çŠ¬ã®ä¾¡å€¤è¦³ã‚²ãƒ¼ãƒ ï¼ˆèª¿æ•´ç‰ˆï¼‰")
st.write("è³ªå•ã«ç­”ãˆã¦ã€ã‚ãªãŸã®çŠ¬ã‚¿ã‚¤ãƒ—ã‚’è¦‹ã¤ã‘ã¾ã—ã‚‡ã†ï¼")

dogs = ["ã‚·ãƒ™ãƒªã‚¢ãƒ³ãƒã‚¹ã‚­ãƒ¼", "ãƒ©ãƒ–ãƒ©ãƒ‰ãƒ¼ãƒ«ãƒ¬ãƒˆãƒªãƒãƒ¼", "ã‚¸ãƒ£ãƒ¼ãƒãƒ³ã‚·ã‚§ãƒ‘ãƒ¼ãƒ‰",
        "ãƒœãƒ¼ãƒ€ãƒ¼ã‚³ãƒªãƒ¼", "ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ãƒ¬ãƒˆãƒªãƒãƒ¼", "æŸ´çŠ¬",
        "ã‚¸ãƒ£ãƒƒã‚¯ãƒ©ãƒƒã‚»ãƒ«ãƒ†ãƒªã‚¢", "ã‚­ãƒ£ãƒãƒªã‚¢ã‚­ãƒ³ã‚°ãƒãƒ£ãƒ¼ãƒ«ã‚ºã‚¹ãƒ‘ãƒ‹ã‚¨ãƒ«",
        "ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ‰ãƒ«", "ãƒ“ãƒ¼ã‚°ãƒ«"]

questions = [
    {"text":"1. æ–°ã—ã„ã“ã¨ã«æŒ‘æˆ¦ã™ã‚‹ã®ã¯å¥½ãï¼Ÿ",
     "ã€‡":["ã‚¸ãƒ£ãƒƒã‚¯ãƒ©ãƒƒã‚»ãƒ«ãƒ†ãƒªã‚¢","ã‚·ãƒ™ãƒªã‚¢ãƒ³ãƒã‚¹ã‚­ãƒ¼","ãƒœãƒ¼ãƒ€ãƒ¼ã‚³ãƒªãƒ¼", "ãƒ“ãƒ¼ã‚°ãƒ«"],
     "â–³":["ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ãƒ¬ãƒˆãƒªãƒãƒ¼","ã‚¸ãƒ£ãƒ¼ãƒãƒ³ã‚·ã‚§ãƒ‘ãƒ¼ãƒ‰"],
     "Ã—":["ãƒ©ãƒ–ãƒ©ãƒ‰ãƒ¼ãƒ«ãƒ¬ãƒˆãƒªãƒãƒ¼","æŸ´çŠ¬","ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ‰ãƒ«","ã‚­ãƒ£ãƒãƒªã‚¢ã‚­ãƒ³ã‚°ãƒãƒ£ãƒ¼ãƒ«ã‚ºã‚¹ãƒ‘ãƒ‹ã‚¨ãƒ«",]},
    {"text":"2. å‹é”ã¨éŠã¶ã®ã¯å¥½ãï¼Ÿ",
     "ã€‡":["ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ãƒ¬ãƒˆãƒªãƒãƒ¼","ãƒ©ãƒ–ãƒ©ãƒ‰ãƒ¼ãƒ«ãƒ¬ãƒˆãƒªãƒãƒ¼","ã‚·ãƒ™ãƒªã‚¢ãƒ³ãƒã‚¹ã‚­ãƒ¼"],
     "â–³":["ã‚¸ãƒ£ãƒƒã‚¯ãƒ©ãƒƒã‚»ãƒ«ãƒ†ãƒªã‚¢","ãƒœãƒ¼ãƒ€ãƒ¼ã‚³ãƒªãƒ¼","ãƒ“ãƒ¼ã‚°ãƒ«"],
     "Ã—":["æŸ´çŠ¬","ã‚­ãƒ£ãƒãƒªã‚¢ã‚­ãƒ³ã‚°ãƒãƒ£ãƒ¼ãƒ«ã‚ºã‚¹ãƒ‘ãƒ‹ã‚¨ãƒ«","ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ‰ãƒ«","ã‚¸ãƒ£ãƒ¼ãƒãƒ³ã‚·ã‚§ãƒ‘ãƒ¼ãƒ‰"]},
    {"text":"3. ãªã‚“ã§ã‚‚è¨ˆç”»ã—ã¦ã‹ã‚‰è¡Œå‹•ã™ã‚‹ï¼Ÿ",
     "ã€‡":["ã‚¸ãƒ£ãƒ¼ãƒãƒ³ã‚·ã‚§ãƒ‘ãƒ¼ãƒ‰","ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ‰ãƒ«","ã‚·ãƒ™ãƒªã‚¢ãƒ³ãƒã‚¹ã‚­ãƒ¼"],
     "â–³":[ "ãƒœãƒ¼ãƒ€ãƒ¼ã‚³ãƒªãƒ¼","ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ãƒ¬ãƒˆãƒªãƒãƒ¼"],
     "Ã—":["ã‚¸ãƒ£ãƒƒã‚¯ãƒ©ãƒƒã‚»ãƒ«ãƒ†ãƒªã‚¢","ãƒ©ãƒ–ãƒ©ãƒ‰ãƒ¼ãƒ«ãƒ¬ãƒˆãƒªãƒãƒ¼", "ã‚­ãƒ£ãƒãƒªã‚¢ã‚­ãƒ³ã‚°ãƒãƒ£ãƒ¼ãƒ«ã‚ºã‚¹ãƒ‘ãƒ‹ã‚¨ãƒ«","æŸ´çŠ¬","ãƒ“ãƒ¼ã‚°ãƒ«"]},
    {"text":"4. å›°ã£ãŸå‹é”ã‚’åŠ©ã‘ãŸã„ï¼Ÿ",
     "ã€‡":["ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ãƒ¬ãƒˆãƒªãƒãƒ¼","ãƒ©ãƒ–ãƒ©ãƒ‰ãƒ¼ãƒ«ãƒ¬ãƒˆãƒªãƒãƒ¼","ã‚­ãƒ£ãƒãƒªã‚¢ã‚­ãƒ³ã‚°ãƒãƒ£ãƒ¼ãƒ«ã‚ºã‚¹ãƒ‘ãƒ‹ã‚¨ãƒ«"],
     "â–³":["ãƒœãƒ¼ãƒ€ãƒ¼ã‚³ãƒªãƒ¼","ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ‰ãƒ«", "ãƒ“ãƒ¼ã‚°ãƒ«"],
     "Ã—":["ã‚¸ãƒ£ãƒƒã‚¯ãƒ©ãƒƒã‚»ãƒ«ãƒ†ãƒªã‚¢","æŸ´çŠ¬","ã‚·ãƒ™ãƒªã‚¢ãƒ³ãƒã‚¹ã‚­ãƒ¼","ã‚¸ãƒ£ãƒ¼ãƒãƒ³ã‚·ã‚§ãƒ‘ãƒ¼ãƒ‰"]},
    {"text":"5. ã˜ã£ãã‚Šè€ƒãˆã¦ã‹ã‚‰ç­”ãˆã‚’å‡ºã™ï¼Ÿ",
     "ã€‡":["ã‚¸ãƒ£ãƒ¼ãƒãƒ³ã‚·ã‚§ãƒ‘ãƒ¼ãƒ‰","æŸ´çŠ¬","ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ‰ãƒ«"],
     "â–³":["ã‚­ãƒ£ãƒãƒªã‚¢ã‚­ãƒ³ã‚°ãƒãƒ£ãƒ¼ãƒ«ã‚ºã‚¹ãƒ‘ãƒ‹ã‚¨ãƒ«","ãƒ©ãƒ–ãƒ©ãƒ‰ãƒ¼ãƒ«ãƒ¬ãƒˆãƒªãƒãƒ¼","ã‚¸ãƒ£ãƒƒã‚¯ãƒ©ãƒƒã‚»ãƒ«ãƒ†ãƒªã‚¢"],
     "Ã—":["ã‚·ãƒ™ãƒªã‚¢ãƒ³ãƒã‚¹ã‚­ãƒ¼","ãƒœãƒ¼ãƒ€ãƒ¼ã‚³ãƒªãƒ¼","ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ãƒ¬ãƒˆãƒªãƒãƒ¼","ãƒ“ãƒ¼ã‚°ãƒ«"]}
]

# ã€‡/â–³/Ã— ã®åŸºæœ¬ç‚¹ï¼ˆå·®ã‚’ã¯ã£ãã‚Šã¤ã‘ã‚‹ï¼‰
base_points = {"ã€‡": 4, "â–³": 2, "Ã—": 1}

# è³ªå•ã”ã¨ã®ã€Œè£œæ­£ç‚¹ã€ãƒãƒƒãƒ—ï¼ˆãã®è³ªå•ã§ç‰¹ã«å„ªå…ˆã—ãŸã„çŠ¬ã«åŠ ç‚¹ï¼‰
# ä¾‹: Q1ã§ã¯ã‚·ãƒ™ãƒªã‚¢ãƒ³ãƒã‚¹ã‚­ãƒ¼ã‚’å¼·ã‚ã«ã—ãŸã„ â†’ +3
question_bonus = {
    0: { "ã‚¸ãƒ£ãƒƒã‚¯ãƒ©ãƒƒã‚»ãƒ«ãƒ†ãƒªã‚¢": 3, "ãƒœãƒ¼ãƒ€ãƒ¼ã‚³ãƒªãƒ¼": 2,"ãƒ“ãƒ¼ã‚°ãƒ«":2},
    1: {"ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ãƒ¬ãƒˆãƒªãƒãƒ¼": 2, "ãƒ©ãƒ–ãƒ©ãƒ‰ãƒ¼ãƒ«ãƒ¬ãƒˆãƒªãƒãƒ¼": 1},
    2: {"ã‚¸ãƒ£ãƒ¼ãƒãƒ³ã‚·ã‚§ãƒ‘ãƒ¼ãƒ‰": 1.5, "ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ‰ãƒ«": 2},
    3: {"ãƒ©ãƒ–ãƒ©ãƒ‰ãƒ¼ãƒ«ãƒ¬ãƒˆãƒªãƒãƒ¼": 1.5, "ã‚­ãƒ£ãƒãƒªã‚¢ã‚­ãƒ³ã‚°ãƒãƒ£ãƒ¼ãƒ«ã‚ºã‚¹ãƒ‘ãƒ‹ã‚¨ãƒ«":2.5},
    4: {"æŸ´çŠ¬": 2, "ã‚¸ãƒ£ãƒ¼ãƒãƒ³ã‚·ã‚§ãƒ‘ãƒ¼ãƒ‰":0.5, "ãƒ“ãƒ¼ã‚°ãƒ«":0.5, "ã‚·ãƒ™ãƒªã‚¢ãƒ³ãƒã‚¹ã‚­ãƒ¼":1}
}

# åŒç‚¹æ™‚ã®å„ªå…ˆé †ä½ãƒªã‚¹ãƒˆï¼ˆå·¦ãŒé«˜å„ªå…ˆï¼‰
tiebreak_priority = ["ã‚·ãƒ™ãƒªã‚¢ãƒ³ãƒã‚¹ã‚­ãƒ¼","ãƒ©ãƒ–ãƒ©ãƒ‰ãƒ¼ãƒ«ãƒ¬ãƒˆãƒªãƒãƒ¼","ã‚¸ãƒ£ãƒ¼ãƒãƒ³ã‚·ã‚§ãƒ‘ãƒ¼ãƒ‰",
                     "ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ãƒ¬ãƒˆãƒªãƒãƒ¼","ãƒœãƒ¼ãƒ€ãƒ¼ã‚³ãƒªãƒ¼","æŸ´çŠ¬","ã‚¸ãƒ£ãƒƒã‚¯ãƒ©ãƒƒã‚»ãƒ«ãƒ†ãƒªã‚¢",
                     "ã‚­ãƒ£ãƒãƒªã‚¢ã‚­ãƒ³ã‚°ãƒãƒ£ãƒ¼ãƒ«ã‚ºã‚¹ãƒ‘ãƒ‹ã‚¨ãƒ«","ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãƒ—ãƒ¼ãƒ‰ãƒ«","ãƒ“ãƒ¼ã‚°ãƒ«"]

# session_stateã§å›ç­”ç®¡ç†
if "answers" not in st.session_state:
    st.session_state.answers = ["ã€‡"]*len(questions)  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’ã€‡ã«ã—ã¦ãŠã

for i, q in enumerate(questions):
    st.session_state.answers[i] = st.radio(q["text"], ("ã€‡", "â–³", "Ã—"), key=f"q{i}")

if st.button("çŠ¬ã‚¿ã‚¤ãƒ—ã‚’åˆ¤å®šã™ã‚‹"):
    scores = {dog:0 for dog in dogs}
    # å„è³ªå•ã«å¯¾ã™ã‚‹åŸºæœ¬ç‚¹+è£œæ­£ç‚¹ã‚’åŠ ç®—
    for i, (q, ans) in enumerate(zip(questions, st.session_state.answers)):
        for dog in q[ans]:
            scores[dog] += base_points[ans]
        # è£œæ­£ç‚¹ã‚’åŠ ãˆã‚‹ï¼ˆãã®è³ªå•ã«é–¢ã—ã¦ç‰¹ã«å‡ºã—ã¦ã‚ã’ãŸã„çŠ¬ï¼‰
        bonus_map = question_bonus.get(i, {})
        for dog, b in bonus_map.items():
            scores[dog] += b

    # ã‚¹ã‚³ã‚¢çµæœã‚’è¡¨ç¤ºï¼ˆç¢ºèªç”¨ï¼‰
    st.write("=== ã‚¹ã‚³ã‚¢ä¸€è¦§ï¼ˆå†…éƒ¨ç¢ºèªç”¨ï¼‰ ===")
    sorted_scores = sorted(scores.items(), key=lambda x: x[1], reverse=True)
    for d, s in sorted_scores:
        st.write(f"{d}: {s}")

    # åˆ¤å®šï¼ˆåŒç‚¹ã¯å„ªå…ˆãƒªã‚¹ãƒˆã§æ±ºå®šï¼‰
    max_score = sorted_scores[0][1]
    top_dogs = [d for d, s in sorted_scores if s == max_score]
    if len(top_dogs) > 1:
        # å„ªå…ˆãƒªã‚¹ãƒˆé †ã§æœ€åˆã«å‡ºç¾ã™ã‚‹çŠ¬ã‚’é¸ã¶ï¼ˆæ±ºå®šçš„ã«ã™ã‚‹ï¼‰
        for p in tiebreak_priority:
            if p in top_dogs:
                result = p
                break
    else:
        result = top_dogs[0]

    st.success(f"ğŸ‰ åˆ¤å®šã•ã‚ŒãŸçŠ¬ã‚¿ã‚¤ãƒ—: {result}")
